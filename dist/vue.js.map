{"version":3,"file":"vue.js","sources":["../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["class Observe {\r\n  constructor(data) {\r\n    // Object.defineProperty 只能劫持已经存在的属性，新增或者删除并不知道【vue2里面会为此单独写api $set $delete】\r\n    this.walk(data); // 遍历对象劫持\r\n  }\r\n  /**\r\n   * 循环对象 对属性依次劫持\r\n   * @param {*} data\r\n   */\r\n  walk(data) {\r\n    // \"重新定义\"属性 【注意：性能差】\r\n    Object.keys(data).forEach((key) => defineReactive(data, key, data[key]));\r\n  }\r\n}\r\n\r\n/**\r\n * 属性劫持\r\n * @param {*} target\r\n * @param {*} key\r\n * @param {*} value\r\n */\r\nexport function defineReactive(target, key, value) {\r\n  // 闭包 属性劫持 递归操作对所有的对象进行属性劫持\r\n  observe(value);\r\n\r\n  // 最后一个参数是闭包，value并不会销毁\r\n  Object.defineProperty(target, key, {\r\n    get() {\r\n      console.log(\"用户取值了\");\r\n      // 取值的时候，会执行get\r\n      return value;\r\n    },\r\n    set(newValue) {\r\n      console.log(\"用户设置值了\");\r\n      // 修改的时候，会执行set\r\n      if (newValue === value) return;\r\n      value = newValue;\r\n    },\r\n  });\r\n}\r\n\r\nexport function observe(data) {\r\n  // 对这个对象进行劫持\r\n  if (typeof data !== \"object\" || data == null) {\r\n    return; // 只对【对象】进行劫持\r\n  }\r\n  // 如果一个对象被劫持过了，那就不需要再被劫持\r\n  // 【要判断对象是否被劫持过,可以增添一个实例，用实例判断是否被劫持】\r\n\r\n  return new Observe(data);\r\n}\r\n","import { observe } from \"./observe/index\";\r\n\r\nexport function initState(vm) {\r\n  const opts = vm.$options;\r\n  if (opts.data) {\r\n    initData(vm);\r\n  }\r\n}\r\n\r\nfunction proxy(vm, target, key) {\r\n  Object.defineProperty(vm, key, {\r\n    // vm.name\r\n    get() {\r\n      return vm[target][key]; // vm._data.name\r\n    },\r\n    set(newValue) {\r\n      vm[target][key] = newValue;\r\n    },\r\n  });\r\n}\r\n\r\nexport function initData(vm) {\r\n  let data = vm.$options.data;\r\n  // vue3中data必须是函数，vue2可以是对象或者函数 注意:call\r\n  // data是用户返回的对象\r\n  data = typeof data === \"function\" ? data.call(vm) : data;\r\n\r\n  vm._data = data; // 使用_data存储值\r\n  // 对数据进行劫持 vue2 采用了api defineProperty\r\n  observe(data);\r\n\r\n  // 将vm._data 用vm来代理即可\r\n  for (const key in data) {\r\n    proxy(vm, \"_data\", key);\r\n  }\r\n}\r\n","import { initState } from \"./state\";\r\n\r\nexport function initMixin(Vue) {\r\n  // 就是给vue添加init方法\r\n  /**\r\n   * 用户初始化方法\r\n   */\r\n  Vue.prototype._init = function (options) {\r\n    // vue vm.$options 就是获取用户的配置\r\n    // 使用vue $nextTick $data $attr......\r\n    const vm = this;\r\n    vm.$options = options; // 将用户选项挂载到实例上\r\n\r\n    // 初始化状态\r\n    initState(vm);\r\n    // todo...\r\n  };\r\n}\r\n","import { initMixin } from \"./init\";\r\n\r\n// 将所有的方法都耦合在一起\r\nfunction Vue(options) {\r\n  this._init(options); // options就是用户的选项\r\n}\r\n\r\ninitMixin(Vue);\r\n\r\nexport default Vue;\r\n"],"names":["Observe","data","_classCallCheck","walk","_createClass","key","value","Object","keys","forEach","defineReactive","target","observe","defineProperty","get","console","log","set","newValue","_typeof","initState","vm","opts","$options","initData","proxy","call","_data","initMixin","Vue","prototype","_init","options"],"mappings":"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"}